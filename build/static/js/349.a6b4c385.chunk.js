"use strict";(self.webpackChunkwonderfullcity_crm=self.webpackChunkwonderfullcity_crm||[]).push([[349],{4268:(e,l,o)=>{o.d(l,{A:()=>i});o(5043);var a=o(289),t=o(6558),n=o(579);const i=e=>{let{label:l,name:o,required:i,required_text:d,warning:s}=e;return(0,n.jsx)(a.A.Item,{label:s?(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:l}),(0,n.jsx)("br",{}),(0,n.jsx)("p",{children:s})]}):(0,n.jsx)("div",{children:l}),name:o,rules:[{required:i,message:d}],children:(0,n.jsx)(t.A,{})})}},5923:(e,l,o)=>{o.d(l,{A:()=>i});o(5043);var a=o(289),t=o(3428),n=o(579);const i=e=>{let{label:l,name:o,required:i,required_text:d}=e;return(0,n.jsx)(a.A.Item,{label:l,name:o,rules:[{required:i,message:d}],children:(0,n.jsx)(t.A,{style:{width:"100%"}})})}},9349:(e,l,o)=>{o.r(l),o.d(l,{default:()=>b});var a=o(5043),t=o(289),n=o(8193),i=o(9800),d=o(1645),s=o(4406),r=o(2895),u=o(1802),c=o(2907),m=o(9888),v=o(8710),p=o(3216),h=o(4556),f=o(6213),g=o(4268),I=o(9488),A=o(5923),x=o(579);const j={name:"",size:null,roomCount:null,price:null,floorId:null,florImageId:[],homeImageId:[],slotId:null,houseId:null},b=()=>{const[e]=t.A.useForm(),l=(0,p.Zp)(),{editId:o}=(0,h.d4)((e=>e.editData)),b=(0,h.wA)(),[y,w]=(0,a.useState)([]),[F,S]=(0,a.useState)([]),[C,q]=(0,a.useState)(""),[D,E]=(0,a.useState)(null),[L,V]=(0,a.useState)(null),{data:M,refetch:_}=(0,c.useQuery)("get-slot",(()=>m.A.getData("/Slot")),{enabled:!1}),{data:z,refetch:P}=(0,c.useQuery)("get-house",(()=>m.A.getData("/House?slotId=".concat(D))),{enabled:!1}),{data:T,refetch:O}=(0,c.useQuery)("get-floor",(()=>m.A.getData("/Floor?housId=".concat(L))),{enabled:!1}),{mutate:U,data:k,isLoading:Q,isSuccess:R}=(0,c.useMutation)((e=>{let{url:l,formData:o}=e;return m.A.postData(l,o)}),{onSuccess:()=>{n.Ay.success("Success")},onError:e=>{for(let l in e.response.data)n.Ay.error("".concat(l,": ").concat(e.response.data[l]))}}),{mutate:H,data:J,isLoading:N,isSuccess:B}=(0,c.useMutation)((e=>{let{url:l,data:o}=e;return m.A.postData(l,o)}),{onSuccess:()=>{n.Ay.success("Success")},onError:e=>{for(let l in e.response.data)n.Ay.error("".concat(l,": ").concat(e.response.data[l]))}}),{isLoading:W,data:Z,refetch:G,isSuccess:K}=(0,c.useQuery)(["edit-apartment",o],(()=>m.A.getDataByID("/Apartment",o)),{enabled:!1}),{mutate:X,isLoading:Y,data:$,isSuccess:ee}=(0,c.useMutation)((e=>{let{url:l,data:o,id:a}=e;return m.A.editData(l,o,a)}),{onSuccess:()=>{n.Ay.success("Success")},onError:e=>{for(let l in e.response.data)n.Ay.error("".concat(l,": ").concat(e.response.data[l]))}}),{mutate:le}=(0,c.useMutation)((e=>{let{url:l,ids:o}=e;return m.A.deleteImages(l,o)}),{onSuccess:()=>n.Ay.success("Success"),onError:e=>n.Ay.error(e.message)});(0,a.useEffect)((()=>{D&&P()}),[D]),(0,a.useEffect)((()=>{L&&O()}),[L]),(0,a.useEffect)((()=>{ee&&b({type:f.aT,payload:""}),(B||ee)&&l("/apartment")}),[J,$]),(0,a.useEffect)((()=>{""!==o&&G()}),[o]),(0,a.useEffect)((()=>{""===o&&e.setFieldsValue(j),_()}),[]),(0,a.useEffect)((()=>{let l=null,o=null;var a,t,n,i;void 0!==Z&&(l=[{uid:null===Z||void 0===Z||null===(a=Z.floorImage)||void 0===a?void 0:a.id,name:null===Z||void 0===Z||null===(t=Z.floorImage)||void 0===t?void 0:t.id,status:"done",url:"".concat("http://95.46.96.124/","/").concat(null===Z||void 0===Z?void 0:Z.floorImage.path)}],o=[{uid:null===Z||void 0===Z||null===(n=Z.homeImage)||void 0===n?void 0:n.id,name:null===Z||void 0===Z||null===(i=Z.homeImage)||void 0===i?void 0:i.id,status:"done",url:"".concat("http://95.46.96.124/","/").concat(null===Z||void 0===Z?void 0:Z.homeImage.path)}]);if(K){var d,s,r,u,c,m,v,p,h,f,g;const a={name:null===Z||void 0===Z?void 0:Z.name,size:null===Z||void 0===Z?void 0:Z.size,roomCount:null===Z||void 0===Z?void 0:Z.roomCount,price:null===Z||void 0===Z?void 0:Z.price,floorId:null===Z||void 0===Z||null===(d=Z.floor)||void 0===d?void 0:d.id,florImageId:l,homeImageId:o,houseId:null===Z||void 0===Z||null===(s=Z.floor)||void 0===s||null===(r=s.house)||void 0===r?void 0:r.id,slotId:null===Z||void 0===Z||null===(u=Z.floor)||void 0===u||null===(c=u.house)||void 0===c||null===(m=c.slot)||void 0===m?void 0:m.id};V(null===Z||void 0===Z||null===(v=Z.floor)||void 0===v||null===(p=v.house)||void 0===p?void 0:p.id),E(null===Z||void 0===Z||null===(h=Z.floor)||void 0===h||null===(f=h.house)||void 0===f||null===(g=f.slot)||void 0===g?void 0:g.id),w(l),S(o),e.setFieldsValue(a)}}),[Z]);(0,a.useEffect)((()=>{const l=JSON.parse(localStorage.getItem("myFormValues"));l&&(l.images=[],e.setFieldsValue(l));const o=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",o),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",o)}}),[]),(0,a.useEffect)((()=>{if(R&&"floor"===C){const l=[{uid:null===k||void 0===k?void 0:k.id,name:null===k||void 0===k?void 0:k.id,status:"done",url:"".concat("http://95.46.96.124/","/").concat(null===k||void 0===k?void 0:k.path)}];e.setFieldsValue({florImageId:l}),w(l),q("")}if(R&&"apartment"===C){const l=[{uid:null===k||void 0===k?void 0:k.id,name:null===k||void 0===k?void 0:k.id,status:"done",url:"".concat("http://95.46.96.124/","/").concat(null===k||void 0===k?void 0:k.path)}];e.setFieldsValue({homeImageId:l}),S(l),q("")}}),[k]);const oe=async e=>{let l=e.url;l||(l=await new Promise((l=>{const o=new FileReader;o.readAsDataURL(e.originFileObj),o.onload=()=>l(o.result)})));const o=new Image;o.src=l;const a=window.open(l);null===a||void 0===a||a.document.write(o.outerHTML)},ae=(0,a.useMemo)((()=>{var e;return null===M||void 0===M||null===(e=M.result)||void 0===e?void 0:e.map((e=>({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.name})))}),[M]),te=(0,a.useMemo)((()=>{var e;return null===z||void 0===z||null===(e=z.result)||void 0===e?void 0:e.map((e=>({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.name})))}),[z]),ne=(0,a.useMemo)((()=>{var e;return null===T||void 0===T||null===(e=T.result)||void 0===e?void 0:e.map((e=>({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.name})))}),[T]);return(0,x.jsx)("div",{children:N||W||Y||Q?(0,x.jsx)(v.HE,{}):(0,x.jsxs)(t.A,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:j,onFinish:e=>{var l,a;const t={name:e.name,size:e.size,roomCount:e.roomCount,price:e.price,floorId:e.floorId,florImageId:null===(l=y[0])||void 0===l?void 0:l.uid,homeImageId:null===(a=F[0])||void 0===a?void 0:a.uid};K?X({url:"/Apartment",data:t,id:o}):H({url:"/Apartment/",data:t})},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,x.jsxs)(i.A,{gutter:20,children:[(0,x.jsx)(d.A,{span:8,children:(0,x.jsx)(t.A.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043b\u043e\u0442",name:"slotId",rules:[{required:!0,message:"\u0412\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0441\u043b\u043e\u0442"}],wrapperCol:{span:24},children:(0,x.jsx)(s.A,{style:{width:"100%"},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u0441\u043b\u043e\u0442",optionLabelProp:"label",onChange:l=>{e.setFieldsValue({houseId:null,floorId:null}),E(l)},options:ae})})}),(0,x.jsx)(d.A,{span:8,children:(0,x.jsx)(t.A.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u043e\u043c",name:"houseId",rules:[{required:!0,message:"\u0412\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0434\u043e\u043c"}],wrapperCol:{span:24},children:(0,x.jsx)(s.A,{style:{width:"100%"},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u0434\u043e\u043c",optionLabelProp:"label",onChange:l=>{e.setFieldsValue({floorId:null}),V(l)},options:te})})}),(0,x.jsx)(d.A,{span:8,children:(0,x.jsx)(t.A.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043f\u043e\u043b",name:"floorId",rules:[{required:!0,message:"\u0412\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u043f\u043e\u043b"}],wrapperCol:{span:24},children:(0,x.jsx)(s.A,{style:{width:"100%"},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u043f\u043e\u043b",optionLabelProp:"label",options:ne})})}),(0,x.jsx)(d.A,{span:12,children:(0,x.jsx)(g.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043a\u0432\u0430\u0440\u0442\u0438\u0440\u0430",label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043a\u0432\u0430\u0440\u0442\u0438\u0440\u0430",name:"name"})}),(0,x.jsx)(d.A,{span:12,children:(0,x.jsx)(A.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043f\u043b\u043e\u0449\u0430\u0434\u044c",label:"\u041f\u043b\u043e\u0449\u0430\u0434\u044c",name:"size"})}),(0,x.jsx)(d.A,{span:12,children:(0,x.jsx)(A.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u043e\u043c\u043d\u0430\u0442",label:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u043e\u043c\u043d\u0430\u0442",name:"roomCount"})}),(0,x.jsx)(d.A,{span:12,children:(0,x.jsx)(A.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0441\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c \u043d\u043e\u043c\u0435\u0440\u0430",label:"\u0421\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c \u043d\u043e\u043c\u0435\u0440\u0430",name:"price"})})]}),(0,x.jsxs)(i.A,{gutter:20,children:[(0,x.jsx)(d.A,{span:12,children:(0,x.jsx)(t.A.Item,{label:"\u0424\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u044f \u0441 \u043f\u043e\u043b\u0430 \u043a\u043e\u043c\u043d\u0430\u0442\u044b",name:"florImageId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}],children:(0,x.jsx)(I.A,{children:(0,x.jsx)(r.A,{maxCount:1,fileList:y,listType:"picture-card",onChange:e=>{let{fileList:l}=e;const o=new FormData;0!==l.length&&(o.append("fromFile",l[0].originFileObj),U({url:"/Image/",formData:o}),q("floor"))},onPreview:oe,onRemove:l=>{const o=null===l||void 0===l?void 0:l.uid;le({url:"/Image/".concat(o)}),e.setFieldsValue({imageId:[]}),w([])},beforeUpload:()=>!1,children:y.length>0?"":"Upload"})})})}),(0,x.jsx)(d.A,{span:12,children:(0,x.jsx)(t.A.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043a\u043e\u043c\u043d\u0430\u0442\u044b",name:"homeImageId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}],children:(0,x.jsx)(I.A,{children:(0,x.jsx)(r.A,{maxCount:1,fileList:F,listType:"picture-card",onChange:e=>{let{fileList:l}=e;const o=new FormData;0!==l.length&&(o.append("fromFile",l[0].originFileObj),U({url:"/Image/",formData:o}),q("apartment"))},onPreview:oe,onRemove:l=>{const o=null===l||void 0===l?void 0:l.uid;le({url:"/Image/".concat(o)}),e.setFieldsValue({imageId:[]}),w([])},beforeUpload:()=>!1,children:F.length>0?"":"Upload"})})})})]}),(0,x.jsx)(u.A,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:K?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]})})}}}]);
//# sourceMappingURL=349.a6b4c385.chunk.js.map
"use strict";(self.webpackChunkwonderfullcity_crm=self.webpackChunkwonderfullcity_crm||[]).push([[29],{4268:(e,a,s)=>{s.d(a,{A:()=>i});s(5043);var r=s(289),t=s(6558),n=s(579);const i=e=>{let{label:a,name:s,required:i,required_text:l,warning:o}=e;return(0,n.jsx)(r.A.Item,{label:o?(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:a}),(0,n.jsx)("br",{}),(0,n.jsx)("p",{children:o})]}):(0,n.jsx)("div",{children:a}),name:s,rules:[{required:i,message:l}],children:(0,n.jsx)(t.A,{})})}},5923:(e,a,s)=>{s.d(a,{A:()=>i});s(5043);var r=s(289),t=s(3428),n=s(579);const i=e=>{let{label:a,name:s,required:i,required_text:l}=e;return(0,n.jsx)(r.A.Item,{label:a,name:s,rules:[{required:i,message:l}],children:(0,n.jsx)(t.A,{style:{width:"100%"}})})}},29:(e,a,s)=>{s.r(a),s.d(a,{default:()=>j});var r=s(5043),t=s(289),n=s(8193),i=s(9800),l=s(1645),o=s(2895),d=s(1802),u=s(2907),c=s(9888),m=s(2289),p=s(3216),v=s(4556),f=s(6213),h=s(4268),g=s(9488),A=s(5923),x=s(579);const w={fulName:"",phoneNumber:"",userName:"",password:"",imageId:[]},j=()=>{const[e]=t.A.useForm(),a=(0,p.Zp)(),{editId:s}=(0,v.d4)((e=>e.editData)),j=(0,v.wA)(),[y,b]=(0,r.useState)([]),[S,N]=(0,r.useState)(null),{mutate:F,data:I,isLoading:q,isSuccess:E}=(0,u.useMutation)((e=>{let{url:a,formData:s}=e;return c.A.postData(a,s)}),{onSuccess:()=>{n.Ay.success("Success")},onError:e=>{for(let a in e.response.data)n.Ay.error("".concat(a,": ").concat(e.response.data[a]))}}),{mutate:D,data:L,isLoading:V,isSuccess:_}=(0,u.useMutation)((e=>{let{url:a,data:s}=e;return c.A.postData(a,s)}),{onSuccess:()=>{n.Ay.success("Success")},onError:e=>{for(let a in e.response.data)n.Ay.error("".concat(a,": ").concat(e.response.data[a]))}}),{isLoading:C,data:U,refetch:M,isSuccess:T}=(0,u.useQuery)(["edit-user",s],(()=>c.A.getDataByID("/User",s)),{enabled:!1}),{mutate:k,isLoading:O,data:R,isSuccess:z}=(0,u.useMutation)((e=>{let{url:a,data:s,id:r}=e;return c.A.editData(a,s,r)}),{onSuccess:()=>{n.Ay.success("Success")},onError:e=>{for(let a in e.response.data)n.Ay.error("".concat(a,": ").concat(e.response.data[a]))}}),{mutate:H,isLoading:J,data:P,isSuccess:B}=(0,u.useMutation)((e=>{let{url:a,data:s,id:r}=e;return c.A.editData(a,s,r)}),{onSuccess:()=>{n.Ay.success("Success")},onError:e=>{for(let a in e.response.data)n.Ay.error("".concat(a,": ").concat(e.response.data[a]))}});(0,r.useEffect)((()=>{z&&j({type:f.aT,payload:""}),(_||z)&&a("/user")}),[L,R]),(0,r.useEffect)((()=>{""!==s&&M()}),[s]),(0,r.useEffect)((()=>{""===s&&e.setFieldsValue(w)}),[]),(0,r.useEffect)((()=>{let a=null;var s,r;void 0!==U&&(a=[{uid:null===U||void 0===U||null===(s=U.image)||void 0===s?void 0:s.id,name:null===U||void 0===U||null===(r=U.image)||void 0===r?void 0:r.id,status:"done",url:"".concat("http://crm.wonderfulcity.uz/","/").concat(null===U||void 0===U?void 0:U.image.path)}]);if(T){const s={name:null===U||void 0===U?void 0:U.name,userName:null===U||void 0===U?void 0:U.userName,password:null===U||void 0===U?void 0:U.password,phoneNumber:null===U||void 0===U?void 0:U.phoneNumber,fulName:null===U||void 0===U?void 0:U.fulName,imageId:a};b(a),e.setFieldsValue(s)}}),[U]);(0,r.useEffect)((()=>{const a=JSON.parse(localStorage.getItem("myFormValues"));a&&(a.images=[],e.setFieldsValue(a));const s=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",s),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",s)}}),[]),(0,r.useEffect)((()=>{let a=B?P:I;if(E||B){const s=[{uid:null===a||void 0===a?void 0:a.id,name:null===a||void 0===a?void 0:a.id,status:"done",url:"".concat("http://crm.wonderfulcity.uz/","/").concat(null===a||void 0===a?void 0:a.path)}];e.setFieldsValue({imageId:s}),b(s)}}),[I,P]);return(0,x.jsx)("div",{children:V||C||O||q||J?(0,x.jsx)(m.HE,{}):(0,x.jsxs)(t.A,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:w,onFinish:e=>{var a;const r={userName:e.userName,password:e.password,phoneNumber:e.phoneNumber,fulName:e.fulName,imageId:y[0]?null===(a=y[0])||void 0===a?void 0:a.uid:1};T?k({url:"/User",data:r,id:s}):D({url:"/User/",data:r})},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,x.jsxs)(i.A,{gutter:20,children:[(0,x.jsx)(l.A,{span:12,children:(0,x.jsx)(h.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043f\u043e\u043b\u043d\u043e\u0435 \u0438\u043c\u044f",label:"\u041f\u043e\u043b\u043d\u043e\u0435 \u0438\u043c\u044f",name:"fulName"})}),(0,x.jsx)(l.A,{span:12,children:(0,x.jsx)(A.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430",label:"\u041d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430",name:"phoneNumber"})}),(0,x.jsx)(l.A,{span:12,children:(0,x.jsx)(h.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f login",label:"Login",name:"userName"})}),(0,x.jsx)(l.A,{span:12,children:(0,x.jsx)(h.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043f\u0430\u0440\u043e\u043b\u044c",label:"\u041f\u0430\u0440\u043e\u043b\u044c",name:"password"})})]}),(0,x.jsx)(i.A,{gutter:20,children:(0,x.jsx)(l.A,{span:12,children:(0,x.jsx)(t.A.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",name:"imageId",children:(0,x.jsx)(g.A,{children:(0,x.jsx)(o.A,{maxCount:1,fileList:y,listType:"picture-card",onChange:e=>{let{fileList:a}=e;const s=new FormData;0!==a.length&&(s.append("fromFile",a[0].originFileObj),T&&S?H({url:"/Image",data:s,id:S}):F({url:"/Image/",formData:s}))},onPreview:async e=>{let a=e.url;a||(a=await new Promise((a=>{const s=new FileReader;s.readAsDataURL(e.originFileObj),s.onload=()=>a(s.result)})));const s=new Image;s.src=a;const r=window.open(a);null===r||void 0===r||r.document.write(s.outerHTML)},onRemove:a=>{const s=null===a||void 0===a?void 0:a.uid;N(s),e.setFieldsValue({imageId:[]}),b([])},beforeUpload:()=>!1,children:y.length>0?"":"Upload"})})})})}),(0,x.jsx)(d.A,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:T?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]})})}}}]);
//# sourceMappingURL=29.e098e176.chunk.js.map
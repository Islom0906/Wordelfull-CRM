"use strict";(self.webpackChunkwonderfullcity_crm=self.webpackChunkwonderfullcity_crm||[]).push([[185],{4268:(e,a,t)=>{t.d(a,{A:()=>n});t(5043);var s=t(289),l=t(6558),o=t(579);const n=e=>{let{label:a,name:t,required:n,required_text:i,warning:r}=e;return(0,o.jsx)(s.A.Item,{label:r?(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{children:a}),(0,o.jsx)("br",{}),(0,o.jsx)("p",{children:r})]}):(0,o.jsx)("div",{children:a}),name:t,rules:[{required:n,message:i}],children:(0,o.jsx)(l.A,{})})}},9185:(e,a,t)=>{t.r(a),t.d(a,{default:()=>w});var s=t(5043),l=t(289),o=t(8193),n=t(9800),i=t(1645),r=t(4406),d=t(2895),u=t(1802),c=t(2907),m=t(9888),p=t(8710),v=t(3216),g=t(4556),f=t(6213),h=t(4268),A=t(9488),y=t(579);const x={name:"",slotId:null,imageId:[]},w=()=>{const[e]=l.A.useForm(),a=(0,v.Zp)(),{editId:t}=(0,g.d4)((e=>e.editData)),w=(0,g.wA)(),[j,I]=(0,s.useState)([]),[S,b]=(0,s.useState)(null),{data:F,refetch:D}=(0,c.useQuery)("get-slot",(()=>m.A.getData("/Slot")),{enabled:!1}),{mutate:E,data:L,isLoading:V,isSuccess:C}=(0,c.useMutation)((e=>{let{url:a,formData:t}=e;return m.A.postData(a,t)}),{onSuccess:()=>{o.Ay.success("Success")},onError:e=>{for(let a in e.response.data)o.Ay.error("".concat(a,": ").concat(e.response.data[a]))}}),{mutate:q,data:M,isLoading:H,isSuccess:T}=(0,c.useMutation)((e=>{let{url:a,data:t}=e;return m.A.postData(a,t)}),{onSuccess:()=>{o.Ay.success("Success")},onError:e=>{for(let a in e.response.data)o.Ay.error("".concat(a,": ").concat(e.response.data[a]))}}),{isLoading:k,data:O,refetch:_,isSuccess:P}=(0,c.useQuery)(["edit-house",t],(()=>m.A.getDataByID("/House",t)),{enabled:!1}),{mutate:R,isLoading:U,data:z,isSuccess:J}=(0,c.useMutation)((e=>{let{url:a,data:t,id:s}=e;return m.A.editData(a,t,s)}),{onSuccess:()=>{o.Ay.success("Success")},onError:e=>{for(let a in e.response.data)o.Ay.error("".concat(a,": ").concat(e.response.data[a]))}}),{mutate:N,isLoading:Q,data:B,isSuccess:W}=(0,c.useMutation)((e=>{let{url:a,data:t,id:s}=e;return m.A.editData(a,t,s)}),{onSuccess:()=>{o.Ay.success("Success")},onError:e=>{for(let a in e.response.data)o.Ay.error("".concat(a,": ").concat(e.response.data[a]))}});(0,s.useEffect)((()=>{J&&w({type:f.aT,payload:""}),(T||J)&&a("/house")}),[M,z]),(0,s.useEffect)((()=>{""!==t&&_()}),[t]),(0,s.useEffect)((()=>{""===t&&e.setFieldsValue(x),D()}),[]),(0,s.useEffect)((()=>{let a=null;var t,s;void 0!==O&&(a=[{uid:null===O||void 0===O||null===(t=O.image)||void 0===t?void 0:t.id,name:null===O||void 0===O||null===(s=O.image)||void 0===s?void 0:s.id,status:"done",url:"".concat("http://crm.wonderfulcity.uz","/").concat(null===O||void 0===O?void 0:O.image.path)}]);if(P){var l;const t={name:null===O||void 0===O?void 0:O.name,slotId:null===O||void 0===O||null===(l=O.slot)||void 0===l?void 0:l.id,imageId:a};I(a),e.setFieldsValue(t)}}),[O]);(0,s.useEffect)((()=>{const a=JSON.parse(localStorage.getItem("myFormValues"));a&&(a.images=[],e.setFieldsValue(a));const t=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",t),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",t)}}),[]),(0,s.useEffect)((()=>{let a=W?B:L;if(C||W){const t=[{uid:null===a||void 0===a?void 0:a.id,name:null===a||void 0===a?void 0:a.id,status:"done",url:"".concat("http://crm.wonderfulcity.uz","/").concat(null===a||void 0===a?void 0:a.path)}];e.setFieldsValue({imageId:t}),I(t)}}),[L,B]);const Z=(0,s.useMemo)((()=>{var e;return null===F||void 0===F||null===(e=F.result)||void 0===e?void 0:e.map((e=>({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.name})))}),[F]);return(0,y.jsx)("div",{children:H||k||U||V||Q?(0,y.jsx)(p.HE,{}):(0,y.jsxs)(l.A,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:x,onFinish:e=>{var a;const s={name:e.name,slotId:e.slotId,imageId:null===(a=j[0])||void 0===a?void 0:a.uid};P?R({url:"/House",data:s,id:t}):q({url:"/House/",data:s})},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,y.jsxs)(n.A,{gutter:20,children:[(0,y.jsx)(i.A,{span:12,children:(0,y.jsx)(h.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043c",label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043c",name:"name"})}),(0,y.jsx)(i.A,{span:12,children:(0,y.jsx)(l.A.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043b\u043e\u0442",name:"slotId",rules:[{required:!0,message:"\u0412\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0441\u043b\u043e\u0442"}],wrapperCol:{span:24},children:(0,y.jsx)(r.A,{style:{width:"100%"},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u0441\u043b\u043e\u0442",optionLabelProp:"label",options:Z})})})]}),(0,y.jsx)(n.A,{gutter:20,children:(0,y.jsx)(i.A,{span:12,children:(0,y.jsx)(l.A.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043e\u043c\u0430",name:"imageId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}],children:(0,y.jsx)(A.A,{children:(0,y.jsx)(d.A,{maxCount:1,fileList:j,listType:"picture-card",onChange:e=>{let{fileList:a}=e;const t=new FormData;0!==a.length&&(t.append("fromFile",a[0].originFileObj),P&&S?N({url:"/Image",data:t,id:S}):E({url:"/Image/",formData:t}))},onPreview:async e=>{let a=e.url;a||(a=await new Promise((a=>{const t=new FileReader;t.readAsDataURL(e.originFileObj),t.onload=()=>a(t.result)})));const t=new Image;t.src=a;const s=window.open(a);null===s||void 0===s||s.document.write(t.outerHTML)},onRemove:a=>{const t=null===a||void 0===a?void 0:a.uid;b(t),e.setFieldsValue({imageId:[]}),I([])},beforeUpload:()=>!1,children:j.length>0?"":"Upload"})})})})}),(0,y.jsx)(u.A,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:P?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]})})}}}]);
//# sourceMappingURL=185.b4dd0a5a.chunk.js.map
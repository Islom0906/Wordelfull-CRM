(self.webpackChunkwonderfullcity_crm=self.webpackChunkwonderfullcity_crm||[]).push([[944],{8944:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>S});var n=o(5043),l=o(289),a=o(8193),s=o(4435),d=o(9800),r=o(1645),i=o(4406),u=o(1802),c=o(5397),f=o(9888),p=o(2907),v=o(4954),h=o(4124),m=o(8914),b=o(184),x=o(2289),A=o(7407),I=o(9422),g=o(579);const j={status:null},w=e=>{let{data:t,refetch:o,setPdfId:c,setIsLoadingPdf:w}=e;const{user:y}=(0,I.Z)(),[C]=l.A.useForm(),[E,L]=(0,n.useState)(!1),[S,k]=(0,n.useState)(null),{mutate:F,data:M,isLoading:R,isSuccess:D}=(0,p.useMutation)((e=>{let{url:t,data:o,id:n}=e;return f.A.editData(t,o,n)}),{onSuccess:()=>{a.Ay.success("Success")},onError:e=>{for(let t in e.response.data)a.Ay.error("".concat(t,": ").concat(e.response.data[t][0]))}}),P=e=>{F({url:"/Apartment/SelerUpdateAsync",data:e,id:S})};(0,n.useEffect)((()=>{D&&(L(!1),C.setFieldsValue(j),o())}),[M]);const U=(0,n.useMemo)((()=>{const e=[{value:1,label:"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u043e"},{value:2,label:"\u0417\u0430\u043d\u044f\u0442\u043e"}];return"admin"===y.role[1]&&e.push({value:3,label:"\u041f\u0440\u043e\u0434\u0430\u043d\u043e"}),e}),[]),O=[{title:"\u041a\u0432\u0430\u0440\u0442\u0438\u0440\u0430",dataIndex:"name",id:"name",render:e=>(0,g.jsx)("p",{children:e})},{title:"\u041f\u043b\u043e\u0449\u0430\u0434\u044c",dataIndex:"size",id:"size",render:e=>(0,g.jsxs)("p",{children:[e,"\u043c\xb2"]})},{title:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",dataIndex:"roomCount",id:"roomCount",render:e=>(0,g.jsx)("p",{children:e})},{title:"\u0421\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c",dataIndex:"price",id:"price",render:e=>(0,g.jsxs)("p",{children:[e,"$"]})},{title:"\u0421\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435",dataIndex:"status",id:"status",render:(e,t)=>(0,g.jsx)(u.A,{onClick:()=>{return e=t.id,L(!0),void k(e);var e},style:{backgroundColor:1===e?"green":2===e?"#f7ff00":"#ff0000",color:1===e?"#fff":2===e?"#000000":"#fff"},icon:(0,g.jsx)(A.A,{}),children:1===e?"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u043e":2===e?"\u0417\u0430\u043d\u044f\u0442\u043e":"\u041f\u0440\u043e\u0434\u0430\u043d\u043e"})},{title:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",dataIndex:"homeImage",id:"homeImage",render:e=>(0,g.jsx)(v.A,{width:50,src:"".concat("https://crm.wonderfulcity.uz/","/").concat(null===e||void 0===e?void 0:e.path)})},{title:"PDF",id:"action",render:(e,t)=>(0,g.jsx)(s.A,{size:20,children:(0,g.jsx)(u.A,{disabled:3===t.status,onClick:()=>{return e=t.id,c(e),void w(!0);var e},type:"outline",icon:(0,g.jsx)(b.kl1,{})})})}];return(0,g.jsxs)("div",{children:[(0,g.jsx)(h.A,{title:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0439",open:E,onOk:()=>{C.validateFields().then((e=>{P(e)})).catch((e=>{console.log("Failed:",e)}))},onCancel:()=>{L(!1)},children:R?(0,g.jsx)(x.HE,{}):(0,g.jsx)(l.A,{form:C,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:j,onFinish:P,autoComplete:"off",children:(0,g.jsx)(d.A,{gutter:20,children:(0,g.jsx)(r.A,{span:24,children:(0,g.jsx)(l.A.Item,{label:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043e\u043c\u0430",name:"status",rules:[{required:!0,message:"\u0412\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435"}],wrapperCol:{span:24},children:(0,g.jsx)(i.A,{style:{width:"100%"},placeholder:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043e\u043c\u0430",optionLabelProp:"label",options:U})})})})})}),(0,g.jsx)(m.A,{columns:O,dataSource:t,rowKey:e=>e.id})]})};var y=o(3002),C=o(2032),E=o(5931),L=o(2450);const S=()=>{const[e]=l.A.useForm(),[t,o]=(0,n.useState)(""),[v,h]=(0,n.useState)({slotId:null,houseId:null,floorId:null}),[m,b]=(0,n.useState)(null),[x,A]=(0,n.useState)(!1),{data:I,refetch:j,isSuccess:S}=(0,p.useQuery)("get-pdf",(()=>f.A.getDataByID("/PdfData",m)),{enabled:!1}),{data:k,refetch:F}=(0,p.useQuery)("get-slot",(()=>f.A.getData("/Slot")),{enabled:!1}),{data:M,refetch:R,remove:D}=(0,p.useQuery)("get-house",(()=>f.A.getData("/House?slotId=".concat(null===v||void 0===v?void 0:v.slotId))),{enabled:!1}),{data:P,refetch:U,remove:O}=(0,p.useQuery)("get-floor",(()=>f.A.getData("/Floor?housId=".concat(null===v||void 0===v?void 0:v.houseId))),{enabled:!1}),{data:T,isLoading:B,refetch:H}=(0,p.useQuery)("selling-apartment-get",(()=>f.A.getData("/Apartment/?".concat(t?"status=".concat(t):"").concat(null!==v&&void 0!==v&&v.slotId?"&SlotId=".concat(null===v||void 0===v?void 0:v.slotId):"").concat(null!==v&&void 0!==v&&v.houseId?"&HouseId=".concat(null===v||void 0===v?void 0:v.houseId):"").concat(null!==v&&void 0!==v&&v.floorId?"&FlorId=".concat(null===v||void 0===v?void 0:v.floorId):""))),{onError:e=>{a.Ay.error(e)}});(0,n.useEffect)((()=>{console.log("render"),S&&m&&(0,C.x8)((0,g.jsx)(E.A,{data:I})).toBlob().then((e=>{A(!1),b(null),(0,L.saveAs)(e,"Wonderfull-city.pdf")}))}),[I]),(0,n.useEffect)((()=>{m&&j()}),[m]),(0,n.useEffect)((()=>{F()}),[]),(0,n.useEffect)((()=>{null!==v&&void 0!==v&&v.slotId&&R()}),[null===v||void 0===v?void 0:v.slotId]),(0,n.useEffect)((()=>{null!==v&&void 0!==v&&v.houseId&&U()}),[null===v||void 0===v?void 0:v.houseId]),(0,n.useEffect)((()=>{H()}),[t,v]);const z=(0,n.useMemo)((()=>[{value:"",label:"\u0412\u0441\u0435"},{value:1,label:"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u043e"},{value:2,label:"\u0417\u0430\u043d\u044f\u0442\u043e"},{value:3,label:"\u041f\u0440\u043e\u0434\u0430\u043d\u043e"}]),[]),Q=(0,n.useMemo)((()=>{var e;return null===k||void 0===k||null===(e=k.result)||void 0===e?void 0:e.map((e=>({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.name})))}),[k]),V=(0,n.useMemo)((()=>{var e;return null===M||void 0===M||null===(e=M.result)||void 0===e?void 0:e.map((e=>({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.name})))}),[M]),_=(0,n.useMemo)((()=>{var e;return null===P||void 0===P||null===(e=P.result)||void 0===e?void 0:e.map((e=>({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.name})))}),[P]);return(0,g.jsx)("div",{className:"site-space-compact-wrapper",children:(0,g.jsxs)(s.A,{direction:"vertical",style:{width:"100%"},children:[(0,g.jsx)(l.A,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},autoComplete:"off",children:(0,g.jsxs)(d.A,{gutter:20,children:[(0,g.jsx)(r.A,{span:6,children:(0,g.jsx)(l.A.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043b\u043e\u0442",name:"slotId",wrapperCol:{span:24},children:(0,g.jsx)(i.A,{style:{width:"100%"},optionLabelProp:"label",onChange:t=>{e.setFieldsValue({houseId:null,floorId:null}),h({slotId:t,houseId:null,floorId:null})},options:Q})})}),(0,g.jsx)(r.A,{span:6,children:(0,g.jsx)(l.A.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u043e\u043c",name:"houseId",wrapperCol:{span:24},children:(0,g.jsx)(i.A,{style:{width:"100%"},optionLabelProp:"label",onChange:t=>{e.setFieldsValue({floorId:null}),h((e=>({...e,houseId:t,floorId:null})))},options:V})})}),(0,g.jsx)(r.A,{span:6,children:(0,g.jsx)(l.A.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u044d\u0442\u0430\u0436",name:"floorId",wrapperCol:{span:24},children:(0,g.jsx)(i.A,{style:{width:"100%"},optionLabelProp:"label",options:_,onChange:e=>{h((t=>({...t,floorId:e})))}})})}),(0,g.jsx)(r.A,{span:6,children:(0,g.jsx)(l.A.Item,{label:"\u0424\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e \u0441\u0442\u0430\u0442\u0443\u0441\u0443",name:"status",wrapperCol:{span:24},children:(0,g.jsx)(i.A,{style:{width:"100%"},optionLabelProp:"label",onChange:e=>{o(e)},options:z})})})]})}),(0,g.jsx)(d.A,{gutter:20,children:(0,g.jsx)(r.A,{offset:18,span:6,children:(0,g.jsx)(u.A,{type:"dashed",icon:(0,g.jsx)(y.UCj,{}),style:{width:"100%"},onClick:()=>{e.setFieldsValue({slotId:null,houseId:null,floorId:null,status:""}),h({slotId:null,houseId:null,floorId:null}),o(""),D(),O()},children:"\u041e\u0447\u0438\u0441\u0442\u043a\u0430 \u0444\u0438\u043b\u044c\u0442\u0440\u0430"})})}),(0,g.jsx)(c.A,{size:"medium",spinning:B||x,children:(0,g.jsx)(w,{data:null===T||void 0===T?void 0:T.result,refetch:H,setPdfId:b,setIsLoadingPdf:A})})]})})}},2450:function(e,t,o){var n,l,a;l=[],void 0===(a="function"===typeof(n=function(){"use strict";function t(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function n(e,t,o){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){r(n.response,t,o)},n.onerror=function(){console.error("could not download file")},n.send()}function l(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function a(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var s="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof o.g&&o.g.global===o.g?o.g:void 0,d=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),r=s.saveAs||("object"!=typeof window||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!d?function(e,t,o){var d=s.URL||s.webkitURL,r=document.createElement("a");t=t||e.name||"download",r.download=t,r.rel="noopener","string"==typeof e?(r.href=e,r.origin===location.origin?a(r):l(r.href)?n(e,t,o):a(r,r.target="_blank")):(r.href=d.createObjectURL(e),setTimeout((function(){d.revokeObjectURL(r.href)}),4e4),setTimeout((function(){a(r)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,o,s){if(o=o||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,s),o);else if(l(e))n(e,o,s);else{var d=document.createElement("a");d.href=e,d.target="_blank",setTimeout((function(){a(d)}))}}:function(e,t,o,l){if((l=l||open("","_blank"))&&(l.document.title=l.document.body.innerText="downloading..."),"string"==typeof e)return n(e,t,o);var a="application/octet-stream"===e.type,r=/constructor/i.test(s.HTMLElement)||s.safari,i=/CriOS\/[\d]+/.test(navigator.userAgent);if((i||a&&r||d)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var e=u.result;e=i?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),l?l.location.href=e:location=e,l=null},u.readAsDataURL(e)}else{var c=s.URL||s.webkitURL,f=c.createObjectURL(e);l?l.location=f:location.href=f,l=null,setTimeout((function(){c.revokeObjectURL(f)}),4e4)}});s.saveAs=r.saveAs=r,e.exports=r})?n.apply(t,l):n)||(e.exports=a)}}]);
//# sourceMappingURL=944.383c0049.chunk.js.map
"use strict";(self.webpackChunkwonderfullcity_crm=self.webpackChunkwonderfullcity_crm||[]).push([[29],{4268:(e,s,a)=>{a.d(s,{A:()=>i});a(5043);var r=a(289),t=a(6558),n=a(579);const i=e=>{let{label:s,name:a,required:i,required_text:l,warning:o}=e;return(0,n.jsx)(r.A.Item,{label:o?(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:s}),(0,n.jsx)("br",{}),(0,n.jsx)("p",{children:o})]}):(0,n.jsx)("div",{children:s}),name:a,rules:[{required:i,message:l}],children:(0,n.jsx)(t.A,{})})}},5923:(e,s,a)=>{a.d(s,{A:()=>i});a(5043);var r=a(289),t=a(3428),n=a(579);const i=e=>{let{label:s,name:a,required:i,required_text:l}=e;return(0,n.jsx)(r.A.Item,{label:s,name:a,rules:[{required:i,message:l}],children:(0,n.jsx)(t.A,{style:{width:"100%"}})})}},29:(e,s,a)=>{a.r(s),a.d(s,{default:()=>w});var r=a(5043),t=a(289),n=a(8193),i=a(9800),l=a(1645),o=a(2895),d=a(1802),u=a(2907),c=a(9888),m=a(8710),p=a(3216),v=a(4556),h=a(6213),f=a(4268),g=a(9488),A=a(5923),x=a(579);const j={fulName:"",phoneNumber:"",userName:"",password:"",imageId:[]},w=()=>{const[e]=t.A.useForm(),s=(0,p.Zp)(),{editId:a}=(0,v.d4)((e=>e.editData)),w=(0,v.wA)(),[b,y]=(0,r.useState)([]),{mutate:I,data:N,isLoading:F,isSuccess:S}=(0,u.useMutation)((e=>{let{url:s,formData:a}=e;return c.A.postData(s,a)}),{onSuccess:()=>{n.Ay.success("Success")},onError:e=>{for(let s in e.response.data)n.Ay.error("".concat(s,": ").concat(e.response.data[s]))}}),{mutate:q,data:E,isLoading:D,isSuccess:L}=(0,u.useMutation)((e=>{let{url:s,data:a}=e;return c.A.postData(s,a)}),{onSuccess:()=>{n.Ay.success("Success")},onError:e=>{for(let s in e.response.data)n.Ay.error("".concat(s,": ").concat(e.response.data[s]))}}),{isLoading:V,data:_,refetch:C,isSuccess:U}=(0,u.useQuery)(["edit-user",a],(()=>c.A.getDataByID("/User",a)),{enabled:!1}),{mutate:M,isLoading:T,data:k,isSuccess:O}=(0,u.useMutation)((e=>{let{url:s,data:a,id:r}=e;return c.A.editData(s,a,r)}),{onSuccess:()=>{n.Ay.success("Success")},onError:e=>{for(let s in e.response.data)n.Ay.error("".concat(s,": ").concat(e.response.data[s]))}}),{mutate:R}=(0,u.useMutation)((e=>{let{url:s,ids:a}=e;return c.A.deleteImages(s,a)}),{onSuccess:()=>n.Ay.success("Success"),onError:e=>n.Ay.error(e.message)});(0,r.useEffect)((()=>{O&&w({type:h.aT,payload:""}),(L||O)&&s("/user")}),[E,k]),(0,r.useEffect)((()=>{""!==a&&C()}),[a]),(0,r.useEffect)((()=>{""===a&&e.setFieldsValue(j)}),[]),(0,r.useEffect)((()=>{let s=null;var a,r;void 0!==_&&(s=[{uid:null===_||void 0===_||null===(a=_.image)||void 0===a?void 0:a.id,name:null===_||void 0===_||null===(r=_.image)||void 0===r?void 0:r.id,status:"done",url:"".concat("http://95.46.96.124/","/").concat(null===_||void 0===_?void 0:_.image.path)}]);if(U){const a={name:null===_||void 0===_?void 0:_.name,userName:null===_||void 0===_?void 0:_.userName,password:null===_||void 0===_?void 0:_.password,phoneNumber:null===_||void 0===_?void 0:_.phoneNumber,fulName:null===_||void 0===_?void 0:_.fulName,imageId:s};y(s),e.setFieldsValue(a)}}),[_]);(0,r.useEffect)((()=>{const s=JSON.parse(localStorage.getItem("myFormValues"));s&&(s.images=[],e.setFieldsValue(s));const a=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",a),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",a)}}),[]),(0,r.useEffect)((()=>{if(S){const s=[{uid:null===N||void 0===N?void 0:N.id,name:null===N||void 0===N?void 0:N.id,status:"done",url:"".concat("http://95.46.96.124/","/").concat(null===N||void 0===N?void 0:N.path)}];e.setFieldsValue({imageId:s}),y(s)}}),[N]);return(0,x.jsx)("div",{children:D||V||T||F?(0,x.jsx)(m.HE,{}):(0,x.jsxs)(t.A,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:j,onFinish:e=>{var s;const r={userName:e.userName,password:e.password,phoneNumber:e.phoneNumber,fulName:e.fulName,imageId:b[0]?null===(s=b[0])||void 0===s?void 0:s.uid:1};U?M({url:"/User",data:r,id:a}):q({url:"/User/",data:r})},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,x.jsxs)(i.A,{gutter:20,children:[(0,x.jsx)(l.A,{span:12,children:(0,x.jsx)(f.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043f\u043e\u043b\u043d\u043e\u0435 \u0438\u043c\u044f",label:"\u041f\u043e\u043b\u043d\u043e\u0435 \u0438\u043c\u044f",name:"fulName"})}),(0,x.jsx)(l.A,{span:12,children:(0,x.jsx)(A.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430",label:"\u041d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430",name:"phoneNumber"})}),(0,x.jsx)(l.A,{span:12,children:(0,x.jsx)(f.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f login",label:"Login",name:"userName"})}),(0,x.jsx)(l.A,{span:12,children:(0,x.jsx)(f.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043f\u0430\u0440\u043e\u043b\u044c",label:"\u041f\u0430\u0440\u043e\u043b\u044c",name:"password"})})]}),(0,x.jsx)(i.A,{gutter:20,children:(0,x.jsx)(l.A,{span:12,children:(0,x.jsx)(t.A.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",name:"imageId",children:(0,x.jsx)(g.A,{children:(0,x.jsx)(o.A,{maxCount:1,fileList:b,listType:"picture-card",onChange:e=>{let{fileList:s}=e;const a=new FormData;0!==s.length&&(a.append("fromFile",s[0].originFileObj),I({url:"/Image/",formData:a}))},onPreview:async e=>{let s=e.url;s||(s=await new Promise((s=>{const a=new FileReader;a.readAsDataURL(e.originFileObj),a.onload=()=>s(a.result)})));const a=new Image;a.src=s;const r=window.open(s);null===r||void 0===r||r.document.write(a.outerHTML)},onRemove:s=>{const a=null===s||void 0===s?void 0:s.uid;R({url:"/Image/".concat(a)}),e.setFieldsValue({imageId:[]}),y([])},beforeUpload:()=>!1,children:b.length>0?"":"Upload"})})})})}),(0,x.jsx)(d.A,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:U?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]})})}}}]);
//# sourceMappingURL=29.098d561f.chunk.js.map
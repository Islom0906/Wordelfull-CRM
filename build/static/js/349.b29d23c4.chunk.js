"use strict";(self.webpackChunkwonderfullcity_crm=self.webpackChunkwonderfullcity_crm||[]).push([[349],{4268:(e,l,o)=>{o.d(l,{A:()=>d});o(5043);var a=o(289),t=o(6558),n=o(579);const d=e=>{let{label:l,name:o,required:d,required_text:i,warning:r}=e;return(0,n.jsx)(a.A.Item,{label:r?(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:l}),(0,n.jsx)("br",{}),(0,n.jsx)("p",{children:r})]}):(0,n.jsx)("div",{children:l}),name:o,rules:[{required:d,message:i}],children:(0,n.jsx)(t.A,{})})}},5923:(e,l,o)=>{o.d(l,{A:()=>d});o(5043);var a=o(289),t=o(3428),n=o(579);const d=e=>{let{label:l,name:o,required:d,required_text:i}=e;return(0,n.jsx)(a.A.Item,{label:l,name:o,rules:[{required:d,message:i}],children:(0,n.jsx)(t.A,{style:{width:"100%"}})})}},9349:(e,l,o)=>{o.r(l),o.d(l,{default:()=>b});var a=o(5043),t=o(289),n=o(8193),d=o(9800),i=o(1645),r=o(4406),s=o(2895),u=o(1802),c=o(2907),m=o(9888),v=o(2289),p=o(3216),h=o(4556),f=o(6213),g=o(4268),I=o(9488),A=o(5923),x=o(579);const j={name:"",size:null,roomCount:null,price:null,floorId:null,florImageId:[],homeImageId:[],slotId:null,houseId:null},b=()=>{const[e]=t.A.useForm(),l=(0,p.Zp)(),{editId:o}=(0,h.d4)((e=>e.editData)),b=(0,h.wA)(),[y,w]=(0,a.useState)([]),[F,S]=(0,a.useState)([]),[C,q]=(0,a.useState)(""),[D,L]=(0,a.useState)(null),[E,V]=(0,a.useState)(null),[z,M]=(0,a.useState)(null),[_,P]=(0,a.useState)(null),{data:T,refetch:O}=(0,c.useQuery)("get-slot",(()=>m.A.getData("/Slot")),{enabled:!1}),{data:U,refetch:k}=(0,c.useQuery)("get-house",(()=>m.A.getData("/House?slotId=".concat(D))),{enabled:!1}),{data:Q,refetch:R}=(0,c.useQuery)("get-floor",(()=>m.A.getData("/Floor?housId=".concat(E))),{enabled:!1}),{mutate:H,data:J,isLoading:N,isSuccess:B}=(0,c.useMutation)((e=>{let{url:l,formData:o}=e;return m.A.postData(l,o)}),{onSuccess:()=>{n.Ay.success("Success")},onError:e=>{for(let d in null===(l=e.response)||void 0===l||null===(o=l.data)||void 0===o?void 0:o.errors){var l,o,a,t;n.Ay.error("".concat(d,": ").concat(null===(a=e.response)||void 0===a||null===(t=a.data)||void 0===t?void 0:t.errors[d]))}}}),{mutate:W,data:Z,isLoading:$,isSuccess:G}=(0,c.useMutation)((e=>{let{url:l,data:o}=e;return m.A.postData(l,o)}),{onSuccess:()=>{n.Ay.success("Success")},onError:e=>{for(let l in e.response.data)n.Ay.error("".concat(l,": ").concat(e.response.data[l]))}}),{isLoading:K,data:X,refetch:Y,isSuccess:ee}=(0,c.useQuery)(["edit-apartment",o],(()=>m.A.getDataByID("/Apartment",o)),{enabled:!1}),{mutate:le,isLoading:oe,data:ae,isSuccess:te}=(0,c.useMutation)((e=>{let{url:l,data:o,id:a}=e;return m.A.editData(l,o,a)}),{onSuccess:()=>{n.Ay.success("Success")},onError:e=>{for(let l in e.response.data)n.Ay.error("".concat(l,": ").concat(e.response.data[l]))}}),{mutate:ne,isLoading:de,data:ie,isSuccess:re}=(0,c.useMutation)((e=>{let{url:l,data:o,id:a}=e;return m.A.editData(l,o,a)}),{onSuccess:()=>{n.Ay.success("Success")},onError:e=>{for(let l in e.response.data)n.Ay.error("".concat(l,": ").concat(e.response.data[l]))}});(0,a.useEffect)((()=>{D&&k()}),[D]),(0,a.useEffect)((()=>{E&&R()}),[E]),(0,a.useEffect)((()=>{te&&b({type:f.aT,payload:""}),(G||te)&&l("/apartment")}),[Z,ae]),(0,a.useEffect)((()=>{""!==o&&Y()}),[o]),(0,a.useEffect)((()=>{""===o&&e.setFieldsValue(j),O()}),[]),(0,a.useEffect)((()=>{let l=null,o=null;var a,t,n,d;void 0!==X&&(l=[{uid:null===X||void 0===X||null===(a=X.floorImage)||void 0===a?void 0:a.id,name:null===X||void 0===X||null===(t=X.floorImage)||void 0===t?void 0:t.id,status:"done",url:"".concat("https://crm.wonderfulcity.uz/","/").concat(null===X||void 0===X?void 0:X.floorImage.path)}],o=[{uid:null===X||void 0===X||null===(n=X.homeImage)||void 0===n?void 0:n.id,name:null===X||void 0===X||null===(d=X.homeImage)||void 0===d?void 0:d.id,status:"done",url:"".concat("https://crm.wonderfulcity.uz/","/").concat(null===X||void 0===X?void 0:X.homeImage.path)}]);if(ee){var i,r,s,u,c,m,v,p,h,f,g;const a={name:null===X||void 0===X?void 0:X.name,size:null===X||void 0===X?void 0:X.size,roomCount:null===X||void 0===X?void 0:X.roomCount,price:null===X||void 0===X?void 0:X.price,floorId:null===X||void 0===X||null===(i=X.floor)||void 0===i?void 0:i.id,florImageId:l,homeImageId:o,houseId:null===X||void 0===X||null===(r=X.floor)||void 0===r||null===(s=r.house)||void 0===s?void 0:s.id,slotId:null===X||void 0===X||null===(u=X.floor)||void 0===u||null===(c=u.house)||void 0===c||null===(m=c.slot)||void 0===m?void 0:m.id};V(null===X||void 0===X||null===(v=X.floor)||void 0===v||null===(p=v.house)||void 0===p?void 0:p.id),L(null===X||void 0===X||null===(h=X.floor)||void 0===h||null===(f=h.house)||void 0===f||null===(g=f.slot)||void 0===g?void 0:g.id),w(l),S(o),e.setFieldsValue(a)}}),[X]);(0,a.useEffect)((()=>{const l=JSON.parse(localStorage.getItem("myFormValues"));l&&(l.images=[],e.setFieldsValue(l));const o=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",o),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",o)}}),[]),(0,a.useEffect)((()=>{let l=re?ie:J;if((re||B)&&"floor"===C){const o=[{uid:null===l||void 0===l?void 0:l.id,name:null===l||void 0===l?void 0:l.id,status:"done",url:"".concat("https://crm.wonderfulcity.uz/","/").concat(null===l||void 0===l?void 0:l.path)}];e.setFieldsValue({florImageId:o}),w(o),q("")}if((re||B)&&"apartment"===C){const o=[{uid:null===l||void 0===l?void 0:l.id,name:null===l||void 0===l?void 0:l.id,status:"done",url:"".concat("https://crm.wonderfulcity.uz/","/").concat(null===l||void 0===l?void 0:l.path)}];e.setFieldsValue({homeImageId:o}),S(o),q("")}}),[J,ie]);const se=async e=>{let l=e.url;l||(l=await new Promise((l=>{const o=new FileReader;o.readAsDataURL(e.originFileObj),o.onload=()=>l(o.result)})));const o=new Image;o.src=l;const a=window.open(l);null===a||void 0===a||a.document.write(o.outerHTML)},ue=(0,a.useMemo)((()=>{var e;return null===T||void 0===T||null===(e=T.result)||void 0===e?void 0:e.map((e=>({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.name})))}),[T]),ce=(0,a.useMemo)((()=>{var e;return null===U||void 0===U||null===(e=U.result)||void 0===e?void 0:e.map((e=>({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.name})))}),[U]),me=(0,a.useMemo)((()=>{var e;return null===Q||void 0===Q||null===(e=Q.result)||void 0===e?void 0:e.map((e=>({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.name})))}),[Q]);return(0,x.jsx)("div",{children:$||K||oe||N||de?(0,x.jsx)(v.HE,{}):(0,x.jsxs)(t.A,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:j,onFinish:e=>{var l,a;const t={name:e.name,size:e.size,roomCount:e.roomCount,price:e.price,floorId:e.floorId,florImageId:null===(l=y[0])||void 0===l?void 0:l.uid,homeImageId:null===(a=F[0])||void 0===a?void 0:a.uid};ee?(t.status=null===X||void 0===X?void 0:X.status,le({url:"/Apartment",data:t,id:o})):W({url:"/Apartment/",data:t})},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,x.jsxs)(d.A,{gutter:20,children:[(0,x.jsx)(i.A,{span:8,children:(0,x.jsx)(t.A.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043b\u043e\u0442",name:"slotId",rules:[{required:!0,message:"\u0412\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0441\u043b\u043e\u0442"}],wrapperCol:{span:24},children:(0,x.jsx)(r.A,{style:{width:"100%"},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u0441\u043b\u043e\u0442",optionLabelProp:"label",onChange:l=>{e.setFieldsValue({houseId:null,floorId:null}),L(l)},options:ue})})}),(0,x.jsx)(i.A,{span:8,children:(0,x.jsx)(t.A.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u043e\u043c",name:"houseId",rules:[{required:!0,message:"\u0412\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0434\u043e\u043c"}],wrapperCol:{span:24},children:(0,x.jsx)(r.A,{style:{width:"100%"},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u0434\u043e\u043c",optionLabelProp:"label",onChange:l=>{e.setFieldsValue({floorId:null}),V(l)},options:ce})})}),(0,x.jsx)(i.A,{span:8,children:(0,x.jsx)(t.A.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u044d\u0442\u0430\u0436",name:"floorId",rules:[{required:!0,message:"\u0412\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u044d\u0442\u0430\u0436"}],wrapperCol:{span:24},children:(0,x.jsx)(r.A,{style:{width:"100%"},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u044d\u0442\u0430\u0436",optionLabelProp:"label",options:me})})}),(0,x.jsx)(i.A,{span:12,children:(0,x.jsx)(g.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043a\u0432\u0430\u0440\u0442\u0438\u0440\u0430",label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043a\u0432\u0430\u0440\u0442\u0438\u0440\u0430",name:"name"})}),(0,x.jsx)(i.A,{span:12,children:(0,x.jsx)(A.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043f\u043b\u043e\u0449\u0430\u0434\u044c",label:"\u041f\u043b\u043e\u0449\u0430\u0434\u044c (\u043c\xb2)",name:"size"})}),(0,x.jsx)(i.A,{span:12,children:(0,x.jsx)(A.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u043e\u043c\u043d\u0430\u0442\u0430",label:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u043e\u043c\u043d\u0430\u0442\u0430",name:"roomCount"})}),(0,x.jsx)(i.A,{span:12,children:(0,x.jsx)(A.A,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0441\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c \u043a\u0432\u0430\u0440\u0442\u0438\u0440\u0430",label:"\u0421\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c \u043a\u0432\u0430\u0440\u0442\u0438\u0440\u0430 ($)",name:"price"})})]}),(0,x.jsxs)(d.A,{gutter:20,children:[(0,x.jsx)(i.A,{span:12,children:(0,x.jsx)(t.A.Item,{label:"\u0424\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u044f \u0441 \u044d\u0442\u0430\u0436\u0430 \u043a\u043e\u043c\u043d\u0430\u0442\u044b",name:"florImageId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}],children:(0,x.jsx)(I.A,{children:(0,x.jsx)(s.A,{maxCount:1,fileList:y,listType:"picture-card",onChange:e=>{let{fileList:l}=e;const o=new FormData;0!==l.length&&(o.append("fromFile",l[0].originFileObj),ee&&z?ne({url:"/Image",data:o,id:z}):H({url:"/Image/",formData:o}),q("floor"))},onPreview:se,onRemove:l=>{const o=null===l||void 0===l?void 0:l.uid;M(o),e.setFieldsValue({florImageId:[]}),w([])},beforeUpload:()=>!1,children:y.length>0?"":"Upload"})})})}),(0,x.jsx)(i.A,{span:12,children:(0,x.jsx)(t.A.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043a\u043e\u043c\u043d\u0430\u0442\u044b",name:"homeImageId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}],children:(0,x.jsx)(I.A,{children:(0,x.jsx)(s.A,{maxCount:1,fileList:F,listType:"picture-card",onChange:e=>{let{fileList:l}=e;const o=new FormData;0!==l.length&&(o.append("fromFile",l[0].originFileObj),ee&&_?ne({url:"/Image",data:o,id:_}):H({url:"/Image/",formData:o}),q("apartment"))},onPreview:se,onRemove:l=>{const o=null===l||void 0===l?void 0:l.uid;P(o),e.setFieldsValue({homeImageId:[]}),S([])},beforeUpload:()=>!1,children:F.length>0?"":"Upload"})})})})]}),(0,x.jsx)(u.A,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:ee?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]})})}}}]);
//# sourceMappingURL=349.b29d23c4.chunk.js.map